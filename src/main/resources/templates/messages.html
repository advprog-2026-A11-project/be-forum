<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>Messages</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; }
    .msg { padding: .5rem; border: 1px solid #ddd; margin-bottom: .5rem; }
    .controls { margin-top: .5rem; }
    form.inline { display: inline-block; margin-left: .5rem; }
    textarea { width: 100%; height: 4rem; }
    .edit-form { margin-top: .5rem; }
  </style>
</head>
<body>
  <h1>Forum</h1>

  <section>
    <h2>Create a message</h2>
    <form th:action="@{/forum/create}" method="post">
      <textarea name="content" placeholder="Type your message" required></textarea>
      <div><button type="submit">Create</button></div>
    </form>
  </section>

  <section>
    <div th:if="${#lists.isEmpty(messages)}">No messages yet.</div>
    <div th:each="msg : ${messages}" class="msg">
      <div class="msg-content" th:text="${msg.content}"></div>
      <div><small th:text="${#temporals.format(msg.createdAt, 'yyyy-MM-dd HH:mm:ss')}"></small></div>

      <div class="controls">
        <button type="button" class="edit-btn" th:attr="data-id=${msg.id}">Edit</button>

        <form th:action="@{/forum/delete}" method="post" class="inline">
          <input type="hidden" name="id" th:value="${msg.id}" />
          <button type="submit">Delete</button>
        </form>
      </div>

      <form class="edit-form" th:attr="id='edit-form-' + ${msg.id}" th:action="@{/forum/update}" method="post" style="display:none;">
        <input type="hidden" name="id" th:value="${msg.id}" />
        <input type="text" name="content" th:value="${msg.content}" required />
        <button type="submit">Update</button>
        <button type="button" class="cancel-btn">Cancel</button>
      </form>
    </div>
  </section>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      document.querySelectorAll('.edit-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
          var id = btn.getAttribute('data-id');
          var form = document.getElementById('edit-form-' + id);
          if (form) form.style.display = (form.style.display === 'none' || form.style.display === '') ? 'block' : 'none';
        });
      });

      document.querySelectorAll('.cancel-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
          var form = btn.closest('.edit-form');
          if (form) form.style.display = 'none';
        });
      });
    });
  </script>
</body>
</html>
